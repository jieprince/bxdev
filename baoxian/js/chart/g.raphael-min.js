/*!
 * g.Raphael 0.51 - Charting library, based on RaphaÃ«l
 *
 * Copyright (c) 2009-2012 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
Raphael.el.popup=function(e,t,n,r){var i=this.paper||this[0].paper,s,o,u,a;if(i){switch(this.type){case"text":case"circle":case"ellipse":o=!0;break;default:o=!1}return e=null==e?"up":e,t=t||5,s=this.getBBox(),n="number"==typeof n?n:o?s.x+s.width/2:s.x,r="number"==typeof r?r:o?s.y+s.height/2:s.y,u=Math.max(s.width/2-t,0),a=Math.max(s.height/2-t,0),this.translate(n-s.x-(o?s.width/2:0),r-s.y-(o?s.height/2:0)),s=this.getBBox(),n={up:["M",n,r,"l",-t,-t,-u,0,"a",t,t,0,0,1,-t,-t,"l",0,-s.height,"a",t,t,0,0,1,t,-t,"l",2*t+2*u,0,"a",t,t,0,0,1,t,t,"l",0,s.height,"a",t,t,0,0,1,-t,t,"l",-u,0,"z"].join(),down:["M",n,r,"l",t,t,u,0,"a",t,t,0,0,1,t,t,"l",0,s.height,"a",t,t,0,0,1,-t,t,"l",-(2*t+2*u),0,"a",t,t,0,0,1,-t,-t,"l",0,-s.height,"a",t,t,0,0,1,t,-t,"l",u,0,"z"].join(),left:["M",n,r,"l",-t,t,0,a,"a",t,t,0,0,1,-t,t,"l",-s.width,0,"a",t,t,0,0,1,-t,-t,"l",0,-(2*t+2*a),"a",t,t,0,0,1,t,-t,"l",s.width,0,"a",t,t,0,0,1,t,t,"l",0,a,"z"].join(),right:["M",n,r,"l",t,-t,0,-a,"a",t,t,0,0,1,t,-t,"l",s.width,0,"a",t,t,0,0,1,t,t,"l",0,2*t+2*a,"a",t,t,0,0,1,-t,t,"l",-s.width,0,"a",t,t,0,0,1,-t,-t,"l",0,-a,"z"].join()},t={up:{x:-!o*(s.width/2),y:2*-t-(o?s.height/2:s.height)},down:{x:-!o*(s.width/2),y:2*t+(o?s.height/2:s.height)},left:{x:2*-t-(o?s.width/2:s.width),y:-!o*(s.height/2)},right:{x:2*t+(o?s.width/2:s.width),y:-!o*(s.height/2)}}[e],this.translate(t.x,t.y),i.path(n[e]).attr({fill:"#000",stroke:"none"}).insertBefore(this.node?this:this[0])}},Raphael.el.tag=function(e,t,n,r){var i=this.paper||this[0].paper;if(i){var i=i.path().attr({fill:"#000",stroke:"#000"}),s=this.getBBox(),o,u,a;switch(this.type){case"text":case"circle":case"ellipse":a=!0;break;default:a=!1}return e=e||0,n="number"==typeof n?n:a?s.x+s.width/2:s.x,r="number"==typeof r?r:a?s.y+s.height/2:s.y,t=null==t?5:t,u=.5522*t,s.height>=2*t?i.attr({path:["M",n,r+t,"a",t,t,0,1,1,0,2*-t,t,t,0,1,1,0,2*t,"m",0,2*-t-3,"a",t+3,t+3,0,1,0,0,2*(t+3),"L",n+t+3,r+s.height/2+3,"l",s.width+6,0,0,-s.height-6,-s.width-6,0,"L",n,r-t-3].join()}):(o=Math.sqrt(Math.pow(t+3,2)-Math.pow(s.height/2+3,2)),i.attr({path:["M",n,r+t,"c",-u,0,-t,u-t,-t,-t,0,-u,t-u,-t,t,-t,u,0,t,t-u,t,t,0,u,u-t,t,-t,t,"M",n+o,r-s.height/2-3,"a",t+3,t+3,0,1,0,0,s.height+6,"l",t+3-o+s.width+6,0,0,-s.height-6,"L",n+o,r-s.height/2-3].join()})),e=360-e,i.rotate(e,n,r),this.attrs?(this.attr(this.attrs.x?"x":"cx",n+t+3+(a?s.width/2:"text"==this.type?s.width:0)).attr("y",a?r:r-s.height/2),this.rotate(e,n,r),90<e&&270>e&&this.attr(this.attrs.x?"x":"cx",n-t-3-(a?s.width/2:s.width)).rotate(180,n,r)):90<e&&270>e?(this.translate(n-s.x-s.width-t-3,r-s.y-s.height/2),this.rotate(e-180,s.x+s.width+t+3,s.y+s.height/2)):(this.translate(n-s.x+t+3,r-s.y-s.height/2),this.rotate(e,s.x-t-3,s.y+s.height/2)),i.insertBefore(this.node?this:this[0])}},Raphael.el.drop=function(e,t,n){var r=this.getBBox(),i=this.paper||this[0].paper,s,o;if(i){switch(this.type){case"text":case"circle":case"ellipse":s=!0;break;default:s=!1}return e=e||0,t="number"==typeof t?t:s?r.x+r.width/2:r.x,n="number"==typeof n?n:s?r.y+r.height/2:r.y,o=Math.max(r.width,r.height)+Math.min(r.width,r.height),i=i.path(["M",t,n,"l",o,0,"A",.4*o,.4*o,0,1,0,t+.7*o,n-.7*o,"z"]).attr({fill:"#000",stroke:"none"}).rotate(22.5-e,t,n),e=(e+90)*Math.PI/180,t=t+o*Math.sin(e)-(s?0:r.width/2),e=n+o*Math.cos(e)-(s?0:r.height/2),this.attrs?this.attr(this.attrs.x?"x":"cx",t).attr(this.attrs.y?"y":"cy",e):this.translate(t-r.x,e-r.y),i.insertBefore(this.node?this:this[0])}},Raphael.el.flag=function(e,t,n){var r=this.paper||this[0].paper;if(r){var r=r.path().attr({fill:"#000",stroke:"#000"}),i=this.getBBox(),s=i.height/2,o;switch(this.type){case"text":case"circle":case"ellipse":o=!0;break;default:o=!1}return e=e||0,t="number"==typeof t?t:o?i.x+i.width/2:i.x,n="number"==typeof n?n:o?i.y+i.height/2:i.y,r.attr({path:["M",t,n,"l",s+3,-s-3,i.width+6,0,0,i.height+6,-i.width-6,0,"z"].join()}),e=360-e,r.rotate(e,t,n),this.attrs?(this.attr(this.attrs.x?"x":"cx",t+s+3+(o?i.width/2:"text"==this.type?i.width:0)).attr("y",o?n:n-i.height/2),this.rotate(e,t,n),90<e&&270>e&&this.attr(this.attrs.x?"x":"cx",t-s-3-(o?i.width/2:i.width)).rotate(180,t,n)):90<e&&270>e?(this.translate(t-i.x-i.width-s-3,n-i.y-i.height/2),this.rotate(e-180,i.x+i.width+s+3,i.y+i.height/2)):(this.translate(t-i.x+s+3,n-i.y-i.height/2),this.rotate(e,i.x-s-3,i.y+i.height/2)),r.insertBefore(this.node?this:this[0])}},Raphael.el.label=function(){var e=this.getBBox(),t=this.paper||this[0].paper,n=Math.min(20,e.width+10,e.height+10)/2;if(t)return t.rect(e.x-n/2,e.y-n/2,e.width+n,e.height+n,n).attr({stroke:"none",fill:"#000"}).insertBefore(this.node?this:this[0])},Raphael.el.blob=function(e,t,n){var r=this.getBBox(),i=Math.PI/180,s=this.paper||this[0].paper,o,u;if(s){switch(this.type){case"text":case"circle":case"ellipse":o=!0;break;default:o=!1}s=s.path().attr({fill:"#000",stroke:"none"}),e=(+e+1?e:45)+90,u=Math.min(r.height,r.width);var t="number"==typeof t?t:o?r.x+r.width/2:r.x,n="number"==typeof n?n:o?r.y+r.height/2:r.y,a=Math.max(r.width+u,25*u/12),f=Math.max(r.height+u,25*u/12);o=t+u*Math.sin((e-22.5)*i);var l=n+u*Math.cos((e-22.5)*i),c=t+u*Math.sin((e+22.5)*i),e=n+u*Math.cos((e+22.5)*i),i=(c-o)/2;u=(e-l)/2;var a=a/2,f=f/2,h=-Math.sqrt(Math.abs(a*a*f*f-a*a*u*u-f*f*i*i)/(a*a*u*u+f*f*i*i));return u=h*a*u/f+(c+o)/2,i=h*-f*i/a+(e+l)/2,s.attr({x:u,y:i,path:["M",t,n,"L",c,e,"A",a,f,0,1,1,o,l,"z"].join()}),this.translate(u-r.x-r.width/2,i-r.y-r.height/2),s.insertBefore(this.node?this:this[0])}},Raphael.fn.label=function(e,t,n){var r=this.set(),n=this.text(e,t,n).attr(Raphael.g.txtattr);return r.push(n.label(),n)},Raphael.fn.popup=function(e,t,n,r,i){var s=this.set(),n=this.text(e,t,n).attr(Raphael.g.txtattr);return s.push(n.popup(r,i),n)},Raphael.fn.tag=function(e,t,n,r,i){var s=this.set(),n=this.text(e,t,n).attr(Raphael.g.txtattr);return s.push(n.tag(r,i),n)},Raphael.fn.flag=function(e,t,n,r){var i=this.set(),n=this.text(e,t,n).attr(Raphael.g.txtattr);return i.push(n.flag(r),n)},Raphael.fn.drop=function(e,t,n,r){var i=this.set(),n=this.text(e,t,n).attr(Raphael.g.txtattr);return i.push(n.drop(r),n)},Raphael.fn.blob=function(e,t,n,r){var i=this.set(),n=this.text(e,t,n).attr(Raphael.g.txtattr);return i.push(n.blob(r),n)},Raphael.el.lighter=function(e){var e=e||2,t=[this.attrs.fill,this.attrs.stroke];return this.fs=this.fs||[t[0],t[1]],t[0]=Raphael.rgb2hsb(Raphael.getRGB(t[0]).hex),t[1]=Raphael.rgb2hsb(Raphael.getRGB(t[1]).hex),t[0].b=Math.min(t[0].b*e,1),t[0].s/=e,t[1].b=Math.min(t[1].b*e,1),t[1].s/=e,this.attr({fill:"hsb("+[t[0].h,t[0].s,t[0].b]+")",stroke:"hsb("+[t[1].h,t[1].s,t[1].b]+")"}),this},Raphael.el.darker=function(e){var e=e||2,t=[this.attrs.fill,this.attrs.stroke];return this.fs=this.fs||[t[0],t[1]],t[0]=Raphael.rgb2hsb(Raphael.getRGB(t[0]).hex),t[1]=Raphael.rgb2hsb(Raphael.getRGB(t[1]).hex),t[0].s=Math.min(t[0].s*e,1),t[0].b/=e,t[1].s=Math.min(t[1].s*e,1),t[1].b/=e,this.attr({fill:"hsb("+[t[0].h,t[0].s,t[0].b]+")",stroke:"hsb("+[t[1].h,t[1].s,t[1].b]+")"}),this},Raphael.el.resetBrightness=function(){return this.fs&&(this.attr({fill:this.fs[0],stroke:this.fs[1]}),delete this.fs),this},function(){var e=["lighter","darker","resetBrightness"],t="popup tag flag label drop blob".split(" "),n;for(n in t)(function(e){Raphael.st[e]=function(){return Raphael.el[e].apply(this,arguments)}})(t[n]);for(n in e)(function(e){Raphael.st[e]=function(){for(var t=0;t<this.length;t++)this[t][e].apply(this[t],arguments);return this}})(e[n])}(),Raphael.g={shim:{stroke:"none",fill:"#000","fill-opacity":0},txtattr:{font:"12px Arial, sans-serif",fill:"#fff"},colors:function(){for(var e=[.6,.2,.05,.1333,.75,0],t=[],n=0;10>n;n++)n<e.length?t.push("hsb("+e[n]+",.75, .75)"):t.push("hsb("+e[n-e.length]+", 1, .5)");return t}(),snapEnds:function(e,t,n){function r(e){return.25>Math.abs(e-.5)?~~e+.5:Math.round(e)}var i=e,s=t;if(i==s)return{from:i,to:s,power:0};var i=(s-i)/n,o=s=~~i,n=0;if(s){for(;o;)n--,o=~~(i*Math.pow(10,n))/Math.pow(10,n);n++}else{if(0==i||!isFinite(i))n=1;else for(;!s;)n=n||1,s=~~(i*Math.pow(10,n))/Math.pow(10,n),n++;n&&n--}return s=r(t*Math.pow(10,n))/Math.pow(10,n),s<t&&(s=r((t+.5)*Math.pow(10,n))/Math.pow(10,n)),i=r((e-(0<n?0:.5))*Math.pow(10,n))/Math.pow(10,n),{from:i,to:s,power:n}},axis:function(e,t,n,r,i,s,o,u,a,f,l){var f=null==f?2:f,a=a||"t",s=s||10,l=arguments[arguments.length-1],c="|"==a||" "==a?["M",e+.5,t,"l",0,.001]:1==o||3==o?["M",e+.5,t,"l",0,-n]:["M",e,t+.5,"l",n,0],h=this.snapEnds(r,i,s),p=h.from,d=h.to,v=h.power,m=0,g={font:"11px 'Fontin Sans', Fontin-Sans, sans-serif"},h=l.set(),d=(d-p)/s,y=p,b=0<v?v:0,w=n/s;if(1==+o||3==+o){v=t;for(p=(o-1?1:-1)*(f+3+!!(o-1));v>=t-n;)"-"!=a&&" "!=a&&(c=c.concat(["M",e-("+"==a||"|"==a?f:2*!(o-1)*f),v+.5,"l",2*f+1,0])),h.push(l.text(e+p,v,u&&u[m++]||(Math.round(y)==y?y:+y.toFixed(b))).attr(g).attr({"text-anchor":o-1?"start":"end"})),y+=d,v-=w;Math.round(v+w-(t-n))&&("-"!=a&&" "!=a&&(c=c.concat(["M",e-("+"==a||"|"==a?f:2*!(o-1)*f),t-n+.5,"l",2*f+1,0])),h.push(l.text(e+p,t-n,u&&u[m]||(Math.round(y)==y?y:+y.toFixed(b))).attr(g).attr({"text-anchor":o-1?"start":"end"})))}else{for(var y=p,b=(0<v)*v,p=(o?-1:1)*(f+9+!o),v=e,w=n/s,E=0,S=0;v<=e+n;)"-"!=a&&" "!=a&&(c=c.concat(["M",v+.5,t-("+"==a?f:2*!!o*f),"l",0,2*f+1])),h.push(E=l.text(v,t+p,u&&u[m++]||(Math.round(y)==y?y:+y.toFixed(b))).attr(g)),E=E.getBBox(),S>=E.x-5?h.pop(h.length-1).remove():S=E.x+E.width,y+=d,v+=w;Math.round(v-w-e-n)&&("-"!=a&&" "!=a&&(c=c.concat(["M",e+n+.5,t-("+"==a?f:2*!!o*f),"l",0,2*f+1])),h.push(l.text(e+n,t+p,u&&u[m]||(Math.round(y)==y?y:+y.toFixed(b))).attr(g)))}return c=l.path(c),c.text=h,c.all=l.set([c,h]),c.remove=function(){this.text.remove(),this.constructor.prototype.remove.call(this)},c},labelise:function(e,t,n){return e?(e+"").replace(/(##+(?:\.#+)?)|(%%+(?:\.%+)?)/g,function(e,r,i){if(r)return(+t).toFixed(r.replace(/^#+\.?/g,"").length);if(i)return(100*t/n).toFixed(i.replace(/^%+\.?/g,"").length)+"%"}):(+t).toFixed(0)}};